@model NomesdaHistoriaApp.Models.Apresentacoes




<div id="Apresentacao" style="text-align:center">

    <div id="avButton" style="align-content:center">
        @Html.ActionLink("Iniciar a Avaliação", "avaliar", "Avaliacao", new { username = Session["userID"], codAula = Session["aulaId"], codApr = Model.cod, tipo = Model.tipo }, new { @class = "btn btn-default text-primary", @id = "avaliacaoButton", style = "display:none" })
    </div>

    @if (Model.tipo == "video")

    {
        <video id="videoAula" controls>
            <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="video/mp4">
            <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="video/ogg">
            <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="video/mpeg">
            <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="video/3gpp">
            <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="video/webm">
        </video>
    }


    @if (Model.tipo == "audio")
    {

        <div class="container col-sm-4">
            <img class="talkingtutor" src="~/@Html.Action("LoadUserAvatarImg", new{ })">
            <audio id="audioAula"class="container" controls>
                <source src="@Url.Action("PlayVideo",new {url = "~/"+Model.Multimedia.ElementAt(0).PATH})" type="audio/wav">
            </audio>
        </div>
        <div class="container col-sm-4 audiotext text-center">
            <div class="container mmargin">
                @Html.Action("getAudioText", new { Path =Model.Multimedia.ElementAt(0).texto })        
            </div>
        </div>
    }




    @*http://bootsnipp.com/snippets/featured/bootstrap-carousel-with-text*@

    @if (Model.tipo == "imagem")
    {

        <div class="container">
            <div class="row">

                <div id="myCarousel" class="carousel slide" data-interval="false" data-ride="carousel">

                    @{
        var arr = Html.Action("GetImages", new { multimedia = Model.Multimedia.ToList(), Apid = Model.cod });
        int i = 0;
        int size = arr.ToString().Split('+').Length - 1;

                    }

                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                        @for (int k = 1; k < size; k++)
                        {
                            <li data-target="#myCarousel" data-slide-to="@k"></li>
                        }
                    </ol>

                    <div class="carousel-inner">

                        @foreach (String s in (arr.ToString()).Split('+'))
                        {
                            if (s != null && s != "")
                            {
                                if (@i == 0)
                                {

                                    <div class="item active">

                                        <img src="@s.Split(';')[0]" alt="" height="300" width="500">
                                        <div class="carousel-text"> @s.Split(';')[1] </div>
                                    </div>
                                    i++;
                                }
                                else if (@i == size - 1)
                                {
                                    <div class="item">

                                        @*//botao aqui*@
                                        <img src="@s.Split(';')[0]" alt="" height="300" width="500">




                                        <div class="carousel-text"> @s.Split(';')[1] </div>
                                    </div>
                                    i++;
                                }
                                else
                                {
                                    <div class="item">
                                        <img src="@s.Split(';')[0]" alt="" height="300" width="500" />
                                        <div class="carousel-text"> @s.Split(';')[1] </div>
                                    </div>
                                    i++;
                                }
                            }
                        }

                    </div>


                    <p></p>

                    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    </a>


                </div>

            </div>
        </div>
    }

</div>

<script>
    var flag = false;
    var $myCarousel = $('#myCarousel');
    var $myCarouselControls = $myCarousel.find('.carousel-control');
    var $myCarouselControlsLeft = $myCarouselControls.filter('.left');
    var $myCarouselControlsRight = $myCarouselControls.filter('.right');
    var $myCarouselIndicators = $myCarousel.find('.carousel-indicators li');
    $myCarousel.carousel({
        interval: false
    });
    $myCarousel.carousel('pause');
    $myCarouselControlsLeft.hide();
    var slideCount = $myCarouselIndicators.length;
    $myCarousel.on('slid.bs.carousel', function () {
        var index = $myCarouselIndicators.filter('.active').data('slide-to');
        if (index == 0) { // is first slide
            $myCarouselControlsRight.show();
            $myCarouselControlsLeft.hide();
        } else if (index == slideCount - 1) { // is last slide
            $myCarouselControlsLeft.show();
            $myCarouselControlsRight.hide();
            $("#avaliacaoButton").show();
            //       $myCarousel.carousel('pause');
        } else { // is not first or last slide
            //para voltar a esconder o botao para a avaliacao
            $("#avaliacaoButton").hide();
            $myCarouselControls.show();
        }
    })

</script>



<script>
    //quando estiver o audio a funcionar
    var audio = document.getElementById("audioAula");
    audio.onended = function () {
        $("#avaliacaoButton").show();
        //alert("The audio has ended");
    };
</script>
<script>
    var video = document.getElementById("videoAula");
    video.onended = function () {
        $("#avaliacaoButton").show();
        //alert("The video has ended");
    };
</script>


<style>

    .btn {
        background-color: aliceblue;
        font-size: large;
        color: black;
        margin:2%;
    }

    .carousel {
        align-content: center;
        width: 600px;
        height: 550px;
        vertical-align: central;
        margin: 0 auto;
    }

    .carousel-control.left, .carousel-control.right {
        background-image: none;
    }


    .carousel-inner > .item > img {
        margin: 0 auto;
        width: 600px;
        height: 380px;
    }

    .carousel-text {
        text-align: center;
        font-family: Rockwell;
        font-size: 18px;
        color: #fff;
        background-color: #000;
    }

    .audiotext {
        background-color : white;
        border-radius : 20%;
        border : 2px solid black;
       
    }

    .mmargin {
        margin : 10% 10% 10% 10%;
    }

    .talkingtutor {
        width :80%;
        height : 80%;
    }
</style>
